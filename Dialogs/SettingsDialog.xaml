<platform:DialogWindow 
  x:Class="ChatAssistantVSIX.Dialogs.SettingsDialog"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:vsshell="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
  Title="Indexer Settings" Height="560" Width="540"
  WindowStartupLocation="CenterOwner" ResizeMode="CanResizeWithGrip"
  xmlns:platform="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.15.0"
  xmlns:toolkit="clr-namespace:Community.VisualStudio.Toolkit;assembly=Community.VisualStudio.Toolkit"
  toolkit:Themes.UseVsTheme="True"
  >
  <platform:DialogWindow.Resources>
    <Style TargetType="TabControl">
      <Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
      <Setter Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.WindowKey}}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowBorderKey}}"/>
    </Style>
    <Style TargetType="TabItem">
      <Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="TabItem">
            <Border Name="mainBorder" 
                        BorderThickness="1,1,1,0" 
                        BorderBrush="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowBorderKey}}"
                        Background="{DynamicResource {x:Static vsshell:VsBrushes.WindowKey}}"
                        Margin="2,0" 
                        Padding="10,5">
              <ContentPresenter x:Name="content" ContentSource="Header" RecognizesAccessKey="True" />
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="mainBorder" Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.CommandBarHoverKey}}"/>
              </Trigger>
              <Trigger Property="IsSelected" Value="True">
                <Setter TargetName="mainBorder" Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.FileTabSelectedGradientTopKey}}"/>
                <Setter TargetName="content" Property="TextElement.FontWeight" Value="Bold"/>
                <Setter TargetName="content" Property="TextElement.Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.FileTabSelectedTextKey}}"/>
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
    <Style TargetType="GroupBox">
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="GroupBox">
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
              </Grid.RowDefinitions>
              <Border Grid.Row="0" Margin="0,0,0,5">
                <ContentPresenter ContentSource="Header" RecognizesAccessKey="True">
                  <ContentPresenter.Resources>
                    <Style TargetType="TextBlock">
                      <Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
                      <Setter Property="FontWeight" Value="SemiBold"/>
                    </Style>
                  </ContentPresenter.Resources>
                </ContentPresenter>
              </Border>

              <Border Grid.Row="1" 
                            BorderThickness="1" 
                            BorderBrush="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowBorderKey}}" 
                            Padding="10">
                <ContentPresenter />
              </Border>
            </Grid>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
  </platform:DialogWindow.Resources>
  
  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <TabControl Grid.Row="0">
      <TabItem Header="Projects">
        <Grid Margin="10">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <TextBlock Text="Select projects to index:" Margin="0,0,0,5" 
                     Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>

          <ListView Grid.Row="1" ItemsSource="{Binding ProjectList}" SelectionMode="Multiple">
            <ListView.ItemTemplate>
              <DataTemplate>
                <CheckBox IsChecked="{Binding IsSelected}" 
                              Content="{Binding Name}" 
                              ToolTip="{Binding Path}"
                              Margin="2"/>
              </DataTemplate>
            </ListView.ItemTemplate>
          </ListView>
        </Grid>
      </TabItem>

      <TabItem Header="Folders">
        <StackPanel Margin="10">
          <!--<TextBlock Text="Root Paths (semicolon separated):" Margin="0,5"/>
                    <TextBox Text="{Binding RootPaths, UpdateSourceTrigger=PropertyChanged}"/>-->
          <TextBlock Text="Default Extensions:" Margin="0,10,0,5" 
                     Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
          <TextBox Text="{Binding DefaultExtensions, UpdateSourceTrigger=PropertyChanged}" Height="40" TextWrapping="Wrap" AcceptsReturn="True"/>
          <TextBlock Text="Exclude Patterns:" Margin="0,10,0,5" 
                     Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
          <TextBox Text="{Binding ExcludePatterns, UpdateSourceTrigger=PropertyChanged}" Height="80" TextWrapping="Wrap" AcceptsReturn="True"/>
        </StackPanel>
      </TabItem>

      <TabItem Header="Models">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel Margin="10">
            <GroupBox Header="Embedding" Margin="0,5">
              <StackPanel Margin="5">
                <ComboBox ItemsSource="{Binding EmbeddingChoices}" SelectedItem="{Binding SelectedEmbeddingApi}" Margin="0,0,0,5"/>
                <Grid IsEnabled="{Binding IsEmbeddingCustom}">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                  </Grid.ColumnDefinitions>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                  </Grid.RowDefinitions>
                  <TextBlock Grid.Row="0" Text="URL:" VerticalAlignment="Center" Margin="0,0,5,5"
                             Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
                  <TextBox Grid.Column="1" Text="{Binding EmbeddingUrl}" Margin="0,0,0,5"/>
                  <TextBlock Grid.Row="1" Text="Key:" VerticalAlignment="Center" Margin="0,0,5,5"
                             Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
                  <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding EmbeddingKey}" Margin="0,0,0,5"/>
                  <TextBlock Grid.Row="2" Text="Model:" VerticalAlignment="Center" Margin="0,0,5,0"
                             Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
                  <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding EmbeddingModel}"/>
                </Grid>
              </StackPanel>
            </GroupBox>

            <GroupBox Header="Generation" Margin="0,5">
              <StackPanel Margin="5">
                <ComboBox ItemsSource="{Binding GenerationChoices}" SelectedItem="{Binding SelectedGenerationApi}" Margin="0,0,0,5"/>
                <Grid IsEnabled="{Binding IsGenerationCustom}">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                  </Grid.ColumnDefinitions>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                  </Grid.RowDefinitions>
                  <TextBlock Text="URL:" VerticalAlignment="Center" Margin="0,0,5,5"
                             Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
                  <TextBox Grid.Column="1" Text="{Binding GenerationUrl}" Margin="0,0,0,5"/>
                  <TextBlock Grid.Row="1" Text="Key:" VerticalAlignment="Center" Margin="0,0,5,5"
                             Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
                  <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding GenerationKey}" Margin="0,0,0,5"/>
                  <TextBlock Grid.Row="2" Text="Model:" VerticalAlignment="Center" Margin="0,0,5,0"
                             Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
                  <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding GenerationModel}"/>
                </Grid>
              </StackPanel>
            </GroupBox>
          </StackPanel>
        </ScrollViewer>
      </TabItem>

      <TabItem Header="Chunking">
        <StackPanel Margin="15">
          <Grid >
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="120"/>
              <ColumnDefinition Width="60"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TextBlock Text="Min Tokens:" VerticalAlignment="Center"
                       Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
            <TextBox Grid.Column="1" 
                     Text="{Binding ChunkMinTokens, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=True}" 
                     VerticalAlignment="Center" Margin="0,0,0,5"/>

            <TextBlock Grid.Row="1" Text="Max Tokens:" VerticalAlignment="Center"
                       Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
            <TextBox Grid.Row="1" 
                     Grid.Column="1" 
                     Text="{Binding ChunkMaxTokens, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=True}" 
                     VerticalAlignment="Center" Margin="0,0,0,5"/>

            <TextBlock Grid.Row="2" Text="Overlap (0.0 - 1.0):" VerticalAlignment="Center"
                       Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
            <TextBox Grid.Row="2" Grid.Column="1" 
                     Text="{Binding ChunkOverlapPercent, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=True}" 
                     VerticalAlignment="Center" />
          </Grid>
        </StackPanel>
      </TabItem>
    </TabControl>

    <GroupBox Grid.Row="1" Header="System" Margin="0,10,0,0">
      <StackPanel Margin="5">
        <TextBlock Text="PhenixCode Executable Path:"/>
        <TextBox Text="{Binding ExecutablePath}" Margin="0,5,5,5" IsReadOnly="{Binding !HasSolutionInitialized}" />
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <Button Content="{Binding ServiceStartStopButtonText}" 
                  Click="OnStartStopService" 
                  Padding="5,0" 
                  HorizontalAlignment="Left" 
                  Margin="0,0,5,5" 
                  Width="120"
                  IsEnabled="{Binding ServiceButtonEnabled}"
                  FontWeight="Bold">
          </Button>
          <Button Grid.Column="1" Content="Open settings.json" Click="OnOpenJsonClick" Padding="5,0" 
                            Width="Auto" HorizontalAlignment="Right" Margin="0,0,5,5" />
        </Grid>
        <TextBox Text="{Binding ServiceMessage}" Height="40" TextWrapping="Wrap" IsReadOnly="True"
                 Background="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowBackgroundKey}}"/>
      </StackPanel>
    </GroupBox>

    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
      <Button Content="Save" Width="80" Margin="5" Click="OnSaveClick" IsDefault="True"/>
      <Button Content="Cancel" Width="80" Margin="5" IsCancel="True"/>
    </StackPanel>
  </Grid>
</platform:DialogWindow>